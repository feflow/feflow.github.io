(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{263:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),s("p",[t._v("其实不难，我们充分利用了社区的力量，只要你的脚手架是一个 Yeoman 脚手架即可。如果你会开发 Yeoman 脚手架，那么你已经基本能够开发一个自己的脚手架了；如果你不会，文章后面的部分也会简单地讲解一下。")]),t._v(" "),t._m(2),t._v(" "),s("p",[t._v("如果你已经会开发一个 Yeoman 脚手架了，可以跳过这个章节。但要注意以下要点：")]),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("如果你没有 Yeoman 脚手架的开发经验，那也别急，\b接下来会给一个入门指导，更详细的开发文档请阅读"),s("a",{attrs:{href:"https://yeoman.io/authoring/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),s("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),s("p",[t._v("这里借助了 Yeoman 以及他们写的脚手架生成器，目的是为了快速让大家创建出自己的脚手架。这不是必须选项，但在本教程中最好是按这个步骤来，否则下面可能没法继续。")]),t._v(" "),t._m(7),t._v(" "),s("p",[t._v("现在，只需一行命令即可生成一个脚手架模版：")]),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._v(" "),s("p",[t._v("让我们来看一下生成的脚手架模版的主要目录结构：")]),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),s("p",[t._v("对于个人或者还没有项目模版的团队来说，首要任务当然是规划好自己的项目模版了。在本文示例中，我们将创建一个非常简单的、支持 React 的项目模版。")]),t._v(" "),t._m(16),t._v(" "),s("p",[t._v("我们的模版主要的目录结构如下：")]),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),t._v(" "),s("blockquote",[s("p",[t._v("构建器 builder-feflow-example 只适用于本教程示例脚手架生成的项目，其他脚手架生成的项目需要适配构建器，关于构建器的开发请阅读 "),s("router-link",{attrs:{to:"./advance-builder-custom.html"}},[t._v("自定义构建器")]),t._v(" 这一章。")],1)]),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._m(23),t._v(" "),t._m(24),t._v(" "),s("p",[t._v("有了项目模版之后，我们还缺少根据项目模版创建一个项目的逻辑。最简单逻辑就是复制一份模版到\b当前目录下，当然，高级点的脚手架一般都会有如下过程：")]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._m(28),t._v(" "),s("p",[t._v("示例脚手架的生成逻辑可"),s("a",{attrs:{href:"https://github.com/feflow/generator-feflow-example/blob/master/generators/app/index.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("阅读这里"),s("OutboundLink")],1)]),t._v(" "),t._m(29),t._v(" "),s("p",[t._v("现在，你的脚手架就定制好了，让我们来试一试吧。先安装在 Feflow 主目录下：")]),t._v(" "),t._m(30),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),s("p",[t._v("上述的例子，仅仅是为了简单才这样设计，满足不了生产环境的使用，如果你想看更成熟的脚手架方案，我们现在就有，建议去看看：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/feflow/generator-ivweb",target:"_blank",rel:"noopener noreferrer"}},[t._v("generator-ivweb"),s("OutboundLink")],1)])])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"自定义脚手架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义脚手架","aria-hidden":"true"}},[this._v("#")]),this._v(" 自定义脚手架")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当运行 "),e("code",[this._v("fef init")]),this._v(" 的时候，Feflow 的内置插件会调用一个脚手架来创建项目。那么，如何创建一个自己的脚手架呢？")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"开发一个-yeoman-脚手架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开发一个-yeoman-脚手架","aria-hidden":"true"}},[this._v("#")]),this._v(" 开发一个 Yeoman 脚手架")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("脚手架项目下 "),e("code",[this._v("package.json")]),this._v(" 文件的 "),e("code",[this._v("description")]),this._v(" 字段不能为空。因为在用户选择脚手架时，Feflow 需要用这个字段来提供脚手架说明。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备工作","aria-hidden":"true"}},[this._v("#")]),this._v(" 准备工作")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("全局安装 "),e("code",[this._v("yo")]),this._v(" 和 "),e("code",[this._v("generator-generator")]),this._v("：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("npm install yo generator-generator -g\n# or yarn global add yo generator-generator\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"生成脚手架模版"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成脚手架模版","aria-hidden":"true"}},[this._v("#")]),this._v(" 生成脚手架模版")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("yo generator\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("再次强调，"),e("strong",[this._v("生成过程中询问的 "),e("code",[this._v("Description")]),this._v(" 一定要填写")]),this._v("，Feflow 会使用它来提供脚手架说明。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("你可能会注意到，"),e("strong",[this._v("生成出来的脚手架模版的项目名是以 "),e("code",[this._v("generator-")]),this._v(" 开头的")]),this._v("，如果你自己手动创建一个脚手架，这也是必须的。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("├── generators/\n|   └── app/\n│       ├── index.js\n│       └── templates/\n│           └── dummyfile.txt\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("其中，"),e("code",[this._v("generators/app/index.js")]),this._v(" 文件就是脚手架生成项目的逻辑，而 "),e("code",[this._v("generators/templates/")]),this._v(" 文件夹就是一个项目模版。后面我们主要就是在这两个地方做定制，改造出自己的脚手架。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"创建自己的脚手架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建自己的脚手架","aria-hidden":"true"}},[this._v("#")]),this._v(" 创建自己的脚手架")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"项目模版"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#项目模版","aria-hidden":"true"}},[this._v("#")]),this._v(" 项目模版")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("对于团队来说，一般都会有自己的项目目录结构规范，或者是有现成的项目模版，那要转换成 Yeoman 脚手架的项目模版就很简单了，直接找个项目或者把项目模版复制粘贴到 "),e("code",[this._v("generators/templates/")]),this._v(" 文件夹下即可。但是要接入 Feflow 还需要做些工作。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"创建模版"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建模版","aria-hidden":"true"}},[this._v("#")]),this._v(" 创建模版")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("|- src # 示例源码\n    |- index.html # HTML 入口\n    |- index.js # JS 入口，也是 Webpack 打包的入口\n|- _babelrc # 处理 JSX 的配置\n|- .feflowrc.js # 这个文件是必须的，作为项目和 Feflow 的桥梁\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("其中，如果项目中含有 "),s("code",[t._v(".babelrc")]),t._v(" 这样的文件，推荐在模版中将 "),s("code",[t._v(".")]),t._v(" 换成 "),s("code",[t._v("_")]),t._v("，写成 "),s("code",[t._v("_babelrc")]),t._v(" 这样的形式。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("另外，"),e("code",[this._v(".feflowrc.js")]),this._v(" 是必须的配置文件，Feflow 会读取其中的构建器配置来对 src 中的源码进行打包构建。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h5",{attrs:{id:"动态模版内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#动态模版内容","aria-hidden":"true"}},[this._v("#")]),this._v(" 动态模版内容")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果你想在你的项目模版中加入动态的内容，例如根据询问用户得到的答案来填充项目名称，你就可以在项目模版下的 "),e("code",[this._v("package.json")]),this._v(" 中这样写：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<%= name %>"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Yeoman 模版支持 <%= "),e("em",[this._v("variable")]),this._v(" > 这样的语法来填充动态内容，其中的 "),e("em",[this._v("variable")]),this._v(" 是如何传进来将会在后面看到。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"项目生成逻辑"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#项目生成逻辑","aria-hidden":"true"}},[this._v("#")]),this._v(" 项目生成逻辑")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("询问并接收用户的输入；")]),this._v(" "),e("li",[this._v("执行一些\b自定义的脚本；")]),this._v(" "),e("li",[this._v("根据用户输入和脚本执行的结果渲染项目模版，并\b生成于当前目录下。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("上述的这些逻辑统统都写在 "),e("code",[this._v("generators/app/index.js")]),this._v(" 文件中。通常来说，这个文件\b都满足如下格式：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Generator "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'yeoman-generator'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("extends")]),t._v(" Generator "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化阶段")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initializing")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* code */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 接收用户输入阶段")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prompting")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* code */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 保存配置信息和文件")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("configuring")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* code */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行自定义函数阶段")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* code */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 生成项目目录阶段")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writing")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* code */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 统一处理冲突，如要生成的文件已经存在是否覆盖等处理")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("conflicts")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* code */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装依赖阶段")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* code */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结束阶段")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* code */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Yeoman 提供了一个基础的生成器类 "),e("code",[this._v("Generator")]),this._v("，我们基于它扩展自己的生成逻辑。"),e("code",[this._v("Generator")]),this._v(" 类定义了八个生命周期，它们会按上述代码的顺序依次执行。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"调试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#调试","aria-hidden":"true"}},[this._v("#")]),this._v(" 调试")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("cd <your-path>/generator-startkit-demo\nnpm link\ncd ~/.fef\nnpm link generator-startkit-demo\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("然后再编辑 "),s("code",[t._v("~/.fef/package.json")]),t._v(" 文件（可用 "),s("code",[t._v("vi ~/.fef/package.json")]),t._v(" 编辑），在 "),s("code",[t._v("dependencies")]),t._v(" 字段中添加一行 "),s("code",[t._v('"generator-startkit-demo": "1.0.0"')]),t._v("（版本号随意）。目的是为了让 Feflow 找到你的脚手架。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("现在，可以在你想创建项目的位置运行 "),e("code",[this._v("fef init")]),this._v(" 了。你会看到你的脚手架被展示出来了，选择它，就能开始项目的创建了。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[e("code",[this._v("generator-feflow-example")]),this._v(" 的源码地址是 https://github.com/feflow/generator-feflow-example")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"更成熟的方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更成熟的方案","aria-hidden":"true"}},[this._v("#")]),this._v(" 更成熟的方案")])}],!1,null,null,null);e.default=n.exports}}]);